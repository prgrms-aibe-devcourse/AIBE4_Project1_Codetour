<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ê°•ë¦‰ ì¶”ì²œì¼ì •</title>
    <style>
      :root {
        --brand: #e91e8c;
        --txt: #0f172a;
        --muted: #64748b;
        --bg: #fff;
        --card: #fff;
        --line: #e2e8f0;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, Apple SD Gothic Neo,
          Malgun Gothic, Nanum Gothic, sans-serif;
        background: var(--bg);
        color: var(--txt);
      }
      .wrap {
        width: min(980px, 92vw);
        margin: 36px auto 64px;
      }
      header h1 {
        margin: 0 0 8px;
        font-size: 32px;
        line-height: 1.2;
      }
      header p {
        margin: 0 0 18px;
        color: var(--muted);
      }
      .mapbox {
        height: 500px;
        background: #eef2ff;
        border: 1px solid var(--line);
        border-radius: 16px;
        color: #334155;
        margin: 8px 0 18px;
        overflow: hidden;
      }
      #map {
        width: 100%;
        height: 100%;
      }
      .tabs {
        display: flex;
        gap: 8px;
        margin: 12px 0 8px;
        flex-wrap: wrap;
      }
      .tab {
        padding: 8px 14px;
        border-radius: 999px;
        border: 1px solid var(--line);
        background: #f1f5f9;
        cursor: pointer;
        font-weight: 600;
      }
      .tab.active {
        background: var(--brand);
        color: #fff;
        border-color: var(--brand);
      }
      .pane {
        display: none;
      }
      .pane.active {
        display: block;
      }
      .item {
        display: flex;
        gap: 14px;
        align-items: flex-start;
        background: var(--card);
        border: 1px solid var(--line);
        border-radius: 14px;
        padding: 14px;
        margin: 10px 0;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03);
      }
      .num {
        width: 28px;
        height: 28px;
        border-radius: 999px;
        background: #eef2ff;
        color: #4f46e5;
        display: grid;
        place-items: center;
        font-weight: 700;
      }
      .thumb {
        width: 80px;
        height: 60px;
        border-radius: 10px;
        background: #e2e8f0;
        display: grid;
        place-items: center;
        font-weight: 800;
        color: #475569;
        overflow: hidden;
      }
      .thumb img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 10px;
      }
      .content .title {
        font-size: 18px;
        font-weight: 800;
        margin-bottom: 2px;
      }
      .content .meta {
        font-size: 13px;
        color: var(--muted);
        margin-bottom: 6px;
      }
      .content .rec {
        font-size: 14px;
        color: #334155;
      }
      .cta {
        position: sticky;
        bottom: 18px;
        display: flex;
        justify-content: center;
        margin-top: 22px;
      }
      .cta button {
        background: var(--brand);
        color: #fff;
        border: none;
        border-radius: 999px;
        padding: 12px 20px;
        font-weight: 800;
        cursor: pointer;
        box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header style="text-align: center">
        <h1>
          ê°•ë¦‰, ë§ì¶¤ <span style="color: var(--brand)">ì¶”ì²œì¼ì •</span>ì…ë‹ˆë‹¤.
        </h1>
        <p>
          ë°”ë‹¤Â·ì¹´í˜Â·ìœ ì‚°ì„ í•˜ë£¨ ë™ì„ ì— ë‹´ì•˜ì–´ìš”. ë¶ë¶€Â·ë„ì‹¬Â·ë‚¨ë¶€ë¡œ ë‚˜ëˆ  ì—¬í–‰í•´ìš”.
        </p>
      </header>

      <div class="mapbox"><div id="map"></div></div>

      <div class="tabs">
        <button class="tab active" data-day="1" type="button">Day 1</button>
        <button class="tab" data-day="2" type="button">Day 2</button>
        <button class="tab" data-day="3" type="button">Day 3</button>
      </div>

      <!-- Day 1: ë„ì‹¬Â·ê²½í¬ ë¼ì¸ (ì•ˆëª©-ê²½í¬-ì˜¤ì£½í—Œ) -->
      <section class="pane active" data-day="1">
        <div class="item">
          <div class="num">1</div>
          <div class="thumb">
            <img src="./images/anmok.jpg" alt="ì•ˆëª©ì»¤í”¼ê±°ë¦¬" />
          </div>
          <div class="content">
            <div class="title">ì•ˆëª© ì»¤í”¼ê±°ë¦¬</div>
            <div class="meta">
              cafe street Â·
              <span class="addr">ê°•ì›íŠ¹ë³„ìì¹˜ë„ ê°•ë¦‰ì‹œ ì°½í•´ë¡œ ì¼ëŒ€</span>
            </div>
            <div class="rec">
              ë°”ë‹¤ ë³´ë©° ë¡œìŠ¤í„°ë¦¬ ì¹´í˜ íˆ¬ì–´. ì•„ì¹¨ ì‚°ì±…+ë¸ŒëŸ°ì¹˜ë¡œ ì‹œì‘.
            </div>
          </div>
        </div>
        <div class="item">
          <div class="num">2</div>
          <div class="thumb">
            <img src="./images/gyeongpo-beach.jpg" alt="ê²½í¬í•´ë³€" />
          </div>
          <div class="content">
            <div class="title">ê²½í¬í•´ë³€</div>
            <div class="meta">
              beach Â· <span class="addr">ê°•ì›íŠ¹ë³„ìì¹˜ë„ ê°•ë¦‰ì‹œ ì°½í•´ë¡œ 514</span>
            </div>
            <div class="rec">
              ê°•ë¦‰ ëŒ€í‘œ í•´ë³€. ë³´ë“œëŒ€ì—¬/ì‚°ì±…ë°í¬/í¬í† ìŠ¤íŒŸ í’ë¶€.
            </div>
          </div>
        </div>
        <div class="item">
          <div class="num">3</div>
          <div class="thumb">
            <img src="./images/gyeongpodae.jpg" alt="ê²½í¬ëŒ€" />
          </div>
          <div class="content">
            <div class="title">ê²½í¬ëŒ€ & ê²½í¬í˜¸</div>
            <div class="meta">
              view Â· <span class="addr">ê°•ì›íŠ¹ë³„ìì¹˜ë„ ê°•ë¦‰ì‹œ ì €ë™ 33-6</span>
            </div>
            <div class="rec">
              í˜¸ìˆ˜ ìˆœí™˜ ì‚°ì±…+ì •ì ë·°. ë²šê½ƒÂ·ë‹¨í’ ì‹œì¦Œ íŠ¹íˆ ì•„ë¦„ë‹¤ì›€.
            </div>
          </div>
        </div>
        <div class="item">
          <div class="num">4</div>
          <div class="thumb">
            <img src="./images/ojukheon.jpg" alt="ì˜¤ì£½í—Œ" />
          </div>
          <div class="content">
            <div class="title">ì˜¤ì£½í—ŒÂ·ì‹œë¦½ë°•ë¬¼ê´€</div>
            <div class="meta">
              heritage Â·
              <span class="addr">ê°•ì›íŠ¹ë³„ìì¹˜ë„ ê°•ë¦‰ì‹œ ìœ¨ê³¡ë¡œ3139ë²ˆê¸¸ 24</span>
            </div>
            <div class="rec">
              ì‹ ì‚¬ì„ë‹¹Â·ìœ¨ê³¡ ì´ì´ ìœ ì . í‘ì£½(ì˜¤ì£½) ì •ì› ì‚°ì±….
            </div>
          </div>
        </div>
        <div class="item">
          <div class="num">5</div>
          <div class="thumb">
            <img src="./images/central-market.jpg" alt="ê°•ë¦‰ì¤‘ì•™ì‹œì¥" />
          </div>
          <div class="content">
            <div class="title">ê°•ë¦‰ ì¤‘ì•™ì‹œì¥</div>
            <div class="meta">
              food market Â·
              <span class="addr">ê°•ì›íŠ¹ë³„ìì¹˜ë„ ê°•ë¦‰ì‹œ ê¸ˆì„±ë¡œ 21</span>
            </div>
            <div class="rec">
              ì´ˆë‹¹ë‘ë¶€/ì¥ì¹¼êµ­ìˆ˜/ìˆœë‘ë¶€ ì•„ì´ìŠ¤í¬ë¦¼ ë“± ê¸¸ê±°ë¦¬ ë¨¹ê±°ë¦¬.
            </div>
          </div>
        </div>
      </section>

      <!-- Day 2: ë‚¨ë¶€ ë¼ì¸ (ì •ë™ì§„-ì„ í¬ë£¨ì¦ˆ-í•˜ìŠ¬ë¼) -->
      <section class="pane" data-day="2">
        <div class="item">
          <div class="num">1</div>
          <div class="thumb">
            <img src="./images/jeongdongjin.jpg" alt="ì •ë™ì§„" />
          </div>
          <div class="content">
            <div class="title">ì •ë™ì§„ ëª¨ë˜ì‹œê³„ê³µì›</div>
            <div class="meta">
              sunrise Â·
              <span class="addr">ê°•ì›íŠ¹ë³„ìì¹˜ë„ ê°•ë¦‰ì‹œ ê°•ë™ë©´ ì •ë™ì§„ë¦¬</span>
            </div>
            <div class="rec">
              ì¼ì¶œ ëª…ì†Œ. ëª¨ë˜ì‹œê³„Â·ì² ê¸¸ í¬í† ì¡´, ë ˆì¼ë°”ì´í¬ ì—°ê³„ ê°€ëŠ¥.
            </div>
          </div>
        </div>
        <div class="item">
          <div class="num">2</div>
          <div class="thumb">
            <img src="./images/suncruise.jpg" alt="ëª¨ë˜ì‹œê³„ì†Œë‚˜ë¬´" />
          </div>
          <div class="content">
            <div class="title">ëª¨ë˜ì‹œê³„ ì†Œë‚˜ë¬´</div>
            <div class="meta">
              view Â·
              <span class="addr">ê°•ì›íŠ¹ë³„ìì¹˜ë„ ê°•ë¦‰ì‹œ ê°•ë™ë©´ ì •ë™ì§„ë¦¬</span>
            </div>
            <div class="rec">
              ë°”ë‹·ê°€ì— ìˆëŠ” ì†Œë‚˜ë¬´. ë°”ë‹¤ë°°ê²½ê³¼ ì ˆë¬˜í•˜ê²Œ ì–´ìš°ëŸ¬ì ¸ ì´¬ì˜ì§€ë¡œë„
              ìœ ëª….
            </div>
          </div>
        </div>
        <div class="item">
          <div class="num">3</div>
          <div class="thumb">
            <img src="./images/haslla.jpg" alt="í•˜ìŠ¬ë¼ì•„íŠ¸ì›”ë“œ" />
          </div>
          <div class="content">
            <div class="title">í•˜ìŠ¬ë¼ ì•„íŠ¸ì›”ë“œ</div>
            <div class="meta">
              art museum Â·
              <span class="addr"
                >ê°•ì›íŠ¹ë³„ìì¹˜ë„ ê°•ë¦‰ì‹œ ê°•ë™ë©´ ì •ë™í•´ì•ˆë¡œ 1441</span
              >
            </div>
            <div class="rec">
              ë°”ë‹¤ ë³´ì´ëŠ” ì¡°ê°ê³µì›Â·ë¯¸ìˆ ê´€. ê°ì„± ì‚¬ì§„ ìŠ¤íŒŸ ë§ìŒ.
            </div>
          </div>
        </div>
        <div class="item">
          <div class="num">4</div>
          <div class="thumb">
            <img
              src="./images/unification-park.jpg"
              alt="í”¼ë…¸í‚¤ì˜¤-ë§ˆë¦¬ì˜¤ë„¤íŠ¸ ë¯¸ìˆ ê´€"
            />
          </div>
          <div class="content">
            <div class="title">í”¼ë…¸í‚¤ì˜¤-ë§ˆë¦¬ì˜¤ë„¤íŠ¸ ë¯¸ìˆ ê´€</div>
            <div class="meta">
              museum Â·
              <span class="addr">ê°•ì›íŠ¹ë³„ìì¹˜ë„ ê°•ë¦‰ì‹œ ê°•ë™ë©´ ìœ¨ê³¡ë¡œ 1441</span>
            </div>
            <div class="rec">
              í”¼ë…¸í‚¤ì˜¤ì™€ ë§ˆë¦¬ì˜¤ë„¤íŠ¸ë¥¼ í•¨ê»˜ ë³¼ ìˆ˜ ìˆëŠ” êµ­ë‚´ ìœ ì¼ ë¯¸ìˆ ê´€.
            </div>
          </div>
        </div>
        <div class="item">
          <div class="num">5</div>
          <div class="thumb">
            <img src="./images/sacheon.jpg" alt="ì „ë“±ì‚¬" />
          </div>
          <div class="content">
            <div class="title">ì „ë“±ì‚¬</div>
            <div class="meta">
              beach Â·
              <span class="addr"
                >ê°•ì›íŠ¹ë³„ìì¹˜ë„ ê°•ë¦‰ì‹œ ê°•ë™ë©´ ì •ë™ë“±ëª…ê¸¸ 42-10</span
              >
            </div>
            <div class="rec">ë°”ë‹·ê°€ì— ìˆëŠ” ì ˆ. ê²½ì¹˜ê°€ ì¢‹ê³  ê±´ì¶•ë¬¼ì´ ìœ ë ¤.</div>
          </div>
        </div>
      </section>

      <!-- Day 3: ë¶ë¶€ ë¼ì¸ (ì£¼ë¬¸ì§„-ì˜ì§„-í–¥í˜¸) -->
      <section class="pane" data-day="3">
        <div class="item">
          <div class="num">1</div>
          <div class="thumb">
            <img src="./images/jumunjin-market.jpg" alt="ì£¼ë¬¸ì§„ìˆ˜ì‚°ì‹œì¥" />
          </div>
          <div class="content">
            <div class="title">ì£¼ë¬¸ì§„ ìˆ˜ì‚°ì‹œì¥</div>
            <div class="meta">
              seafood market Â·
              <span class="addr">ê°•ì›íŠ¹ë³„ìì¹˜ë„ ê°•ë¦‰ì‹œ ì£¼ë¬¸ì§„ì ì£¼ë¬¸ë¡œ 16</span>
            </div>
            <div class="rec">
              íšŒ/ëŒ€ê²Œ/í•´ì‚°ë¬¼ í•œìƒ. êµ¬ì… í›„ ìœ„íŒì¥ ì‹ë‹¹ì—ì„œ ì‹ì‚¬ ê°€ëŠ¥.
            </div>
          </div>
        </div>
        <div class="item">
          <div class="num">2</div>
          <div class="thumb">
            <img src="./images/bts-stop.jpg" alt="ì£¼ë¬¸ì§„í•­" />
          </div>
          <div class="content">
            <div class="title">ì£¼ë¬¸ì§„í•­</div>
            <div class="meta">
              spot Â·
              <span class="addr">ê°•ì›íŠ¹ë³„ìì¹˜ë„ ê°•ë¦‰ì‹œ ì£¼ë¬¸ì§„ì êµí•­ë¦¬</span>
            </div>
            <div class="rec">
              ì‹ ì„ í•œ í•´ì‚°ë¬¼ì„ ì¦ê¸¸ ìˆ˜ ìˆëŠ” ê³³. ë‹¤ì–‘í•œ í•´ì‚°ë¬¼ì´ ì¦ë¹„.
            </div>
          </div>
        </div>
        <div class="item">
          <div class="num">3</div>
          <div class="thumb">
            <img src="./images/yeongjin.jpg" alt="ì˜ì§„í•´ë³€" />
          </div>
          <div class="content">
            <div class="title">ì˜ì§„í•´ë³€</div>
            <div class="meta">
              beach Â·
              <span class="addr"
                >ê°•ì›íŠ¹ë³„ìì¹˜ë„ ê°•ë¦‰ì‹œ ì£¼ë¬¸ì§„ì ì˜ì§„ë¦¬ ì¼ëŒ€</span
              >
            </div>
            <div class="rec">
              ë“œë¼ë§ˆ ì´¬ì˜ì§€ë¡œ ìœ ëª…. ì”ì”í•œ íŒŒë„ì™€ ë„“ì€ ëª¨ë˜ì‚¬ì¥.
            </div>
          </div>
        </div>
        <div class="item">
          <div class="num">4</div>
          <div class="thumb">
            <img src="./images/hyangho.jpg" alt="ì˜ì§„êµ" />
          </div>
          <div class="content">
            <div class="title">ì˜ì§„êµ</div>
            <div class="meta">
              lake walk Â·
              <span class="addr"
                >ê°•ì›íŠ¹ë³„ìì¹˜ë„ ê°•ë¦‰ì‹œ ì—°ê³¡ë©´ ë™ë•ë¦¬ 1289-5</span
              >
            </div>
            <div class="rec">
              ë°”ë‹¤ì™€ ë§ë‹¿ì€ ë‹´ìˆ˜í˜¸. ë‹¤ë¦¬ìœ„ì—ì„œ ë°”ë‹¤ë¥¼ ëª¨ë‘ ë³¼ ìˆ˜ ìˆëŠ” í¬ê·€í•œ ê³³.
            </div>
          </div>
        </div>
        <div class="item">
          <div class="num">5</div>
          <div class="thumb">
            <img src="./images/songjeong.jpg" alt="ì—°ê³¡í•´ë³€" />
          </div>
          <div class="content">
            <div class="title">ì—°ê³¡í•´ë³€</div>
            <div class="meta">
              beach Â·
              <span class="addr">ê°•ì›íŠ¹ë³„ìì¹˜ë„ ê°•ë¦‰ì‹œ ì—°ê³¡ë©´ í•´ì•ˆë¡œ 1282</span>
            </div>
            <div class="rec">
              ë„ì‹¬ ê°€ê¹Œìš´ ë°”ë‹¤ë¡œ ì—¬í–‰ ë§ˆë¬´ë¦¬. ì„ì–‘ íƒ€ì´ë° ì¶”ì²œ.
            </div>
          </div>
        </div>
      </section>

      <div class="cta"><button>ë‚´ ì¼ì •ìœ¼ë¡œ ë‹´ê¸°</button></div>
    </div>

    <!-- Kakao Maps SDK -->
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=8d27848d8e0061837441313b57eba277&libraries=services&autoload=false"></script>
    <script type="module">
      let initAuthListener = () => {};
      let getUserId = () => null;
      let getUserNickname = () => null;
      try {
        const mod = await import("/libs/user-manager.js");
        initAuthListener = mod.initAuthListener ?? initAuthListener;
        getUserId = mod.getUserId ?? getUserId;
        getUserNickname = mod.getUserNickname ?? getUserNickname;
      } catch (e) {
        console.warn(
          "user-manager.js ë¡œë“œ ì‹¤íŒ¨, ê²ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ê³„ì† ì§„í–‰í•©ë‹ˆë‹¤.",
          e
        );
      }

      // ì‚¬ìš©ì ì •ë³´ ì´ˆê¸°í™”
      initAuthListener();
      window.currentUser = null;
      const userId = getUserId();
      if (userId)
        window.currentUser = { id: userId, nickname: getUserNickname() };

      const tabs = document.querySelectorAll(".tab");
      const panes = document.querySelectorAll(".pane");

      // ê° DAYë³„ ì¥ì†Œ ë°ì´í„° ì¶”ì¶œ (í‚¤ì›Œë“œ ê²€ìƒ‰ìš©)
      const dayData = {};
      const dayPositions = {}; // ì¢Œí‘œ ì €ì¥ìš©

      panes.forEach((pane) => {
        const day = pane.dataset.day;
        const items = pane.querySelectorAll(".item");
        dayData[day] = Array.from(items).map((item) => ({
          title: item.querySelector(".title").textContent,
          address: item.querySelector(".addr").textContent.trim(),
        }));
        dayPositions[day] = [];
      });

      let map = null;
      let markers = [];
      let polyline = null;
      let placesService = null;
      let currentDay = "1";

      function initKakaoMap() {
        if (typeof kakao === "undefined" || !kakao.maps) {
          setTimeout(initKakaoMap, 100);
          return;
        }
        kakao.maps.load(function () {
          const mapContainer = document.getElementById("map");
          const mapOption = {
            center: new kakao.maps.LatLng(37.7519, 128.8761), // ê°•ë¦‰ì‹œì²­ ê·¼ì²˜ ì¤‘ì‹¬
            level: 9,
          };
          map = new kakao.maps.Map(mapContainer, mapOption);
          placesService = new kakao.maps.services.Places();
          updateMap("1");
        });
      }

      async function keywordToPosition(query) {
        return new Promise((resolve) => {
          placesService.keywordSearch(
            query + " ê°•ë¦‰",
            function (result, status) {
              if (status === kakao.maps.services.Status.OK && result[0]) {
                const r = result[0];
                resolve({ lat: parseFloat(r.y), lng: parseFloat(r.x) });
              } else {
                resolve(null);
              }
            }
          );
        });
      }

      async function updateMap(day) {
        currentDay = day;
        markers.forEach((m) => m.setMap(null));
        markers = [];
        if (polyline) {
          polyline.setMap(null);
          polyline = null;
        }

        const places = dayData[day];
        if (!places || places.length === 0) return;

        const positions = [];
        for (let i = 0; i < places.length; i++) {
          const place = places[i];
          const pos = await keywordToPosition(place.title);
          if (!pos) continue;
          positions.push({
            ...pos,
            title: place.title,
            address: place.address,
          });

          const markerPosition = new kakao.maps.LatLng(pos.lat, pos.lng);
          const customMarker = createCustomMarker(
            markerPosition,
            i + 1,
            i === 0,
            i === places.length - 1,
            place.title
          );
          customMarker.setMap(map);
          markers.push(customMarker);
        }

        dayPositions[day] = positions;

        if (positions.length >= 2) {
          const path = positions.map(
            (p) => new kakao.maps.LatLng(p.lat, p.lng)
          );
          polyline = new kakao.maps.Polyline({
            path,
            strokeWeight: 5,
            strokeColor: "#e91e8c",
            strokeOpacity: 0.7,
            strokeStyle: "solid",
          });
          polyline.setMap(map);
        }

        if (positions.length > 0) {
          const bounds = new kakao.maps.LatLngBounds();
          positions.forEach((p) =>
            bounds.extend(new kakao.maps.LatLng(p.lat, p.lng))
          );
          map.setBounds(bounds);
        }
      }

      function createCustomMarker(position, label, isStart, isEnd, title) {
        let bgColor = "#4f46e5";
        if (isStart) bgColor = "#10b981";
        if (isEnd) bgColor = "#e91e8c";
        const content = document.createElement("div");
        content.style.cssText = `position:relative;width:36px;height:36px;background:${bgColor};border:3px solid white;border-radius:50%;box-shadow:0 3px 8px rgba(0,0,0,.3);display:flex;align-items:center;justify-content:center;font-weight:bold;color:white;font-size:14px;cursor:pointer;transition:transform .2s ease;`;
        content.innerHTML = label;
        content.onmouseover = () => (content.style.transform = "scale(1.2)");
        content.onmouseout = () => (content.style.transform = "scale(1)");
        content.title = title;
        return new kakao.maps.CustomOverlay({
          position,
          content,
          yAnchor: 0.5,
        });
      }

      const tabsWrap = document.querySelector(".tabs");
      tabsWrap.addEventListener("click", (e) => {
        const btn = e.target.closest(".tab");
        if (!btn) return;
        const day = btn.dataset.day;
        document
          .querySelectorAll(".tab")
          .forEach((b) => b.classList.toggle("active", b === btn));
        document
          .querySelectorAll(".pane")
          .forEach((p) => p.classList.toggle("active", p.dataset.day === day));
        if (map) updateMap(day);
      });

      if (document.readyState === "loading")
        document.addEventListener("DOMContentLoaded", initKakaoMap);
      else initKakaoMap();

      // ë‚´ ì¼ì • ë‹´ê¸°
      document
        .querySelector(".cta button")
        .addEventListener("click", async function () {
          if (!window.currentUser) {
            if (
              confirm("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")
            )
              window.location.href = "/auth";
            return;
          }
          const currentDayPlaces = dayPositions[currentDay];
          if (!currentDayPlaces || currentDayPlaces.length === 0) {
            alert("ì¥ì†Œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            return;
          }
          const userId = window.currentUser.id;
          const courseName = prompt(
            "ì½”ìŠ¤ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”",
            `ê°•ë¦‰ ì—¬í–‰ Day ${currentDay}`
          );
          if (!courseName) return;
          try {
            const places = currentDayPlaces.map((pos) => ({
              name: pos.title,
              lat: pos.lat,
              lng: pos.lng,
              mediaTitle: "",
              placeId: null,
            }));
            const res = await fetch("/api/course", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ userId, name: courseName, places }),
            });
            const data = await res.json();
            if (data.success)
              alert(
                `ğŸ‰ ì €ì¥ ì™„ë£Œ!\nì½”ìŠ¤ ID: ${data.courseId}\n\në§ˆì´í˜ì´ì§€ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`
              );
            else alert("ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤ ğŸ˜¢");
          } catch (err) {
            console.error("ì½”ìŠ¤ ì €ì¥ ì˜¤ë¥˜:", err);
            alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤ ğŸ˜¢");
          }
        });
    </script>
  </body>
</html>
